import re
import subprocess
import sys

prog_list = []
succ_list= []

user_in = input()
while user_in != "":
    prog_list.append(user_in)
    user_in = input()

prog_list = [e.split("/")[-1] for e in prog_list]

print("Checking programms for suid escalation:")
for prog in prog_list:
    try:
        result = subprocess.check_output(
            f"python /home/kali/tools/GTFOBLookup/gtfoblookup.py gtfobins search {prog}",
            shell=True,
            stderr=subprocess.STDOUT,  # Merge stderr with stdout
            text=True  # Return output as text
        )

        if "was not found in the local copy of GTFOBins with the specified attributes" in result:
            print(f"[-] {prog}: not found in GTFOBINS")
        else:
            match = re.search(r"suid:\s+Description:.*?Code:(.*?)sudo:", result,re.DOTALL)
            if match == None:
                print(f"[*] {prog}: No SUID")
            else:
                print(f"[+] {prog}: {match.group(1).strip()}")
                succ_list.append(f"{prog}: {match.group(1).strip()}")

    except subprocess.CalledProcessError as e:
        print(f"Error executing command for {prog}: {e.output}")

print("")
if len(succ_list) > 0:
    print("Found suid escalation:")
    for e in succ_list:
        print(e)
else: print("No suid escalation found")
